<script>

    // collapsibles javascript

    const collapsiblesHeaders = document.querySelectorAll(".collapsible-item-header-content");
    collapsiblesHeaders.forEach(collapsiblesHeader => {
        collapsiblesHeader.addEventListener('click', event => {
            collapsiblesHeader.classList.toggle('active')
            const collapsiblesBody = collapsiblesHeader.parentElement.nextElementSibling;
            if (collapsiblesHeader.classList.contains("active")) {
                collapsiblesBody.style.maxHeight = collapsiblesBody.scrollHeight + "px";
            } else {
                collapsiblesBody.style.maxHeight = 0;
            }
        })
    })

    // filters javascript

    const filtersHeader = document.querySelector(".filters-header");
    filtersHeader.addEventListener('click', event => {
        filtersHeader.classList.toggle('active')
        const filtersBody = filtersHeader.nextElementSibling;
        if (filtersHeader.classList.contains("active")) {
            filtersBody.style.maxHeight = filtersBody.scrollHeight + "px";
        } else {
            filtersBody.style.maxHeight = 0;
        }
    })

    // Add comments
    let targetCommentButton
    let targetCommentBox

    const commentsButtons = document.querySelectorAll(".comment-add-button");
    commentsButtons.forEach(commentButton => {
        commentButton.addEventListener('click', event => {
            targetCommentButton = event.target
            console.log(targetCommentButton)
            const userId = targetCommentButton.dataset.userid
            console.log(userId)
            targetCommentBox = commentButton.previousElementSibling.firstElementChild;
            console.log(targetCommentBox)
            const comment = targetCommentBox.value;
            console.log(comment)
            const appendTo = targetCommentButton.parentElement.parentElement.getElementsByTagName('div')[0];
            console.log(appendTo)
            if (comment.trim() != "") addCommentToDB({ userId, comment })
        })
    })

    function addCommentToDB({ userId, comment }) {
        google.script.run.withSuccessHandler(addCommentInPage).withFailureHandler(failedToAddComment).addComment({ userId, comment })
    }

    function addCommentInPage(HTMLContent) {
        console.log(HTMLContent)
        const comments = targetCommentButton.parentElement.parentElement.getElementsByTagName('div')[0];
        console.log(comments)
        if (comments.innerHTML == "No comments yet..") {
            comments.innerHTML = ""
            comments.insertAdjacentHTML('beforeend', HTMLContent)
        }else comments.insertAdjacentHTML('beforeend', HTMLContent)
        targetCommentBox.value = ""
    }

    function failedToAddComment() {
        console.log("failed to add comment")
    }

</script>